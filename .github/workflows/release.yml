---
name: Release

on:
  push:
    branches:
      - main

jobs:
  release:
    name: Distribute
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          submodules: true
      - name: Setup
        uses: actions/setup-node@v3
        with:
          node-version: 18.x
      - name: Install
        run: npm install c8@7 dts-bundle-generator@9.5.1 eslint@9.28 eslint-config-prettier@10.1.5 eslint-plugin-markdown@5.1 eslint-plugin-prettier@5.4.1 eslint-plugin-yaml@1.0.3 prettier@3.1 semantic-release@20.0.2 @stedi/prettier-plugin-jsonata@2.1.3 prettier-plugin-glsl@0.2.1 prettier-plugin-properties@0.3 typescript@5.8.3 @types/node@24 && npm clean-install
      - name: Lint
        run: npx eslint . --ext .js --fix
      - name: Format
        run: npx prettier --write src/**/*.js
      - name: Test
        run: npx c8 -- node test --reporter=spec src/**/*.test.js test/**/*.js
      - name: Build
        run: tsc
      - env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
        name: Deploy
        run: npx semantic-release
